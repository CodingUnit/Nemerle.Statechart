using System;
using System.Linq;
using System.Console;
using System.Collections.Generic;
using System.Threading;
using Nemerle.Collections;
using Nemerle.Utility;

using Nemerle.Statechart;
using System.Reflection;

namespace Nemerle.Statechart.Tests {

  module Program
  {
            
    public Main(pars : array[string]) : void
    {
      match (pars.NToList())
      {
        | name :: fsm :: test :: [] => //assert2(false);
                                       def assembly = Assembly.LoadFrom(name);
                                       def type = assembly.GetType(fsm);
                                       def obj = Activator.CreateInstance(type);
                                       def machine = obj :> ITestStateMachine;
                                       def tester = machine.GetTester();
                                       def interpreter = FsmInterpreter(tester);
                                       interpreter.StartConsole();
                                       def printer = FsmTestGen(machine.GetType().Name, interpreter.History);
                                       printer.GenerateTestMethods($"$test.n");
                                       printer.GenerateOutput($"$test.log");
       | _                        => Console.WriteLine("Usage: fsmtest.exe [assembly] [fsm_type] [out_file_name]");
      }
    }
  }
}
