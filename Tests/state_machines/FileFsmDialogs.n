using Nemerle;
using Nemerle.Collections;
using Nemerle.Text;
using Nemerle.Utility;

using System;
using System.Collections.Generic;
using System.Linq;
using Nemerle.Statechart;
using System.Windows.Forms;
using System.Threading;
using System.ComponentModel;

namespace Nemerle.Statechart.Tests
{
  using FileFsm.Event;
  using FileFsm;

  /// <summary>
  /// Description of FileFsmDialogs.
  /// </summary>
  [statechart(<#

  flags : transition_completed_events;
  //flags : debug;

  //flags : all_sync_invoke;
  
  name : FileDialogs;

  //sync_invoke form;
  
  [Initial]
  state Working
  {
    NewButtonPressed  => NewSaveChecking;
    OpenButtonPressed => OpenSaveChecking;
    ExitButtonPressed   => ExitSaveChecking;
    SaveButtonPressed => SaveFile;
    SaveAsButtonPressed => SaveFileAs;
  }

  state Dialogs
  {
    Cancel => Working;
    _      => Working;

    state NewSaveChecking
    {
      do / save_checking;

      _ => NewDialog;
    }

    state OpenSaveChecking
    {
      do / save_checking;
      _ => OpenDialog;
    }

    state ExitSaveChecking
    {
      do / save_checking;
      _ / send_event(Exiting) => $0;
    }

    state SaveFile
    {
      do / saving_file;
      _ / send_event(FileSaved) => $0;
    }
    
    state SaveFileAs
    {
      do / saving_file_as;
      _ / send_event(FileSaved) => $0;
    }
    
    state NewDialog
    {
      do / new_dialog;
      OK / send_event(NewFileCreated) => $0;
    }

    state OpenDialog
    {
      do / open_dialog;
      OK / send_event(FileSaved) => $0;
    }
  }

  #>
  )]
  public class FileFsmDialogs
  {
    [Accessor]
    file_fsm : FileFsm = FileFsm();
  }
}
